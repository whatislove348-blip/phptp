<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üåç WHOIS + DNS Map & Domain Analyzer</title>
  <style>
    body {font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);color:#fff;margin:0;padding:0;overflow-x:hidden;}
    .container {max-width:1200px;margin:50px auto;padding:40px;background:rgba(255,255,255,0.08);border-radius:20px;box-shadow:0 0 40px rgba(0,255,255,0.3);} 
    h1{text-align:center;color:#00eaff;text-shadow:0 0 25px #00eaff;}
    p{text-align:center;color:#ccc;margin-bottom:30px;}
    .input-group{display:flex;justify-content:center;gap:10px;margin-bottom:20px;}
    input{padding:12px;border:none;border-radius:10px;outline:none;font-size:16px;background:rgba(255,255,255,0.1);color:#fff;}
    select{padding:12px;border:none;border-radius:10px;font-size:16px;outline:none;background:linear-gradient(45deg,#ff007a,#00eaff);color:#fff;font-weight:bold;text-shadow:0 0 5px rgba(0,0,0,0.4);transition:0.3s;cursor:pointer;}
    select:hover{box-shadow:0 0 15px #00eaff;transform:scale(1.05);}
    option{background:#1a1a2e;color:#fff;}
    button{background:linear-gradient(45deg,#00eaff,#ff00c3);border:none;border-radius:10px;padding:12px 20px;color:#000;font-weight:bold;cursor:pointer;transition:0.3s;}
    button:hover{transform:scale(1.05);box-shadow:0 0 20px #00eaff;}
    .loading{text-align:center;color:#00eaff;display:none;margin:15px;}
    .result{background:rgba(0,0,0,0.6);border-radius:15px;padding:25px;margin-top:20px;animation:fadeIn 0.8s ease-in-out;}
    .info-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.1);} 
    .info-row span{color:#00eaff;}
    #validDays{color:#ffdd57;font-weight:bold;}
    #map{width:100%;height:500px;border-radius:15px;margin-top:20px;}
    #dnsTable{width:100%;border-collapse:collapse;margin-top:20px;text-align:center;}
    #dnsTable th,#dnsTable td{border:1px solid rgba(255,255,255,0.2);padding:10px;}
    #dnsTable th{background:rgba(255,255,255,0.15);color:#00eaff;}
    .whois-section{margin-top:20px;padding:15px;background:rgba(255,255,255,0.05);border-radius:10px;}
    .ok-icon{color:#00ff9c;font-size:20px;}
    .fail-icon{color:#ff4c4c;font-size:20px;}
    .chart-container {margin-top: 30px; text-align:center;}
    .summary-box {margin-top: 20px; display:flex; justify-content:space-around; background:rgba(255,255,255,0.1); padding:15px; border-radius:10px;}
    .summary-item {text-align:center;}
    .summary-item h3 {color:#00eaff; margin-bottom:5px;}
    @keyframes fadeIn{from{opacity:0;transform:translateY(20px);}to{opacity:1;transform:translateY(0);}}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <div class="container">
    <h1>üåê WHOIS + Global DNS Propagation Analyzer</h1>
    <p>Check WHOIS details, DNS status, and map-based propagation info for any domain.</p>

    <div class="input-group">
      <input id="domainInput" type="text" placeholder="Enter domain e.g. example.com">
      <select id="recordType">
        <option value="A">A</option>
        <option value="AAAA">AAAA</option>
        <option value="CNAME">CNAME</option>
        <option value="MX">MX</option>
        <option value="NS">NS</option>
        <option value="TXT">TXT</option>
      </select>
      <button id="lookupBtn">Search</button>
    </div>

    <div class="loading" id="loading">üîç Fetching WHOIS and DNS info...</div>

    <div id="result" class="result" style="display:none">
      <div class="whois-section">
        <h3>üîé WHOIS Information</h3>
        <p><strong>Domain:</strong> <span id="whoisDomain">‚Äî</span></p>
        <p><strong>Registrar:</strong> <span id="whoisRegistrar">‚Äî</span></p>
        <p><strong>Created:</strong> <span id="whoisCreated">‚Äî</span></p>
        <p><strong>Updated:</strong> <span id="whoisUpdated">‚Äî</span></p>
        <p><strong>Expires:</strong> <span id="whoisExpires">‚Äî</span></p>
        <p><strong>Status:</strong> <span id="whoisStatus">‚Äî</span></p>
      </div>

      <div class="summary-box">
        <div class="summary-item"><h3>Total Countries</h3><span id="totalCountries">0</span></div>
        <div class="summary-item"><h3>Working</h3><span id="workingCount" style="color:#00ff9c;">0</span></div>
        <div class="summary-item"><h3>Failed</h3><span id="failedCount" style="color:#ff4c4c;">0</span></div>
        <div class="summary-item"><h3>Success %</h3><span id="successRate" style="color:#ffdd57;">0%</span></div>
      </div>

      <canvas id="dnsChart" class="chart-container"></canvas>
      <div id="map"></div>
      <table id="dnsTable"></table>
    </div>
  </div>

  <script>
    const lookupBtn=document.getElementById('lookupBtn');
    const recordType=document.getElementById('recordType');
    const domainInput=document.getElementById('domainInput');
    const loading=document.getElementById('loading');
    const resultBox=document.getElementById('result');
    let map;

    const countries=[{name:'United States',lat:37.09,lon:-95.71},{name:'United Kingdom',lat:55.37,lon:-3.43},{name:'Germany',lat:51.16,lon:10.45},{name:'India',lat:20.59,lon:78.96},{name:'Brazil',lat:-14.23,lon:-51.92},{name:'Australia',lat:-25.27,lon:133.77},{name:'Japan',lat:36.20,lon:138.25},{name:'France',lat:46.22,lon:2.21},{name:'Canada',lat:56.13,lon:-106.34},{name:'South Africa',lat:-30.55,lon:22.93}];

    async function lookupDomain(){
      const domain=domainInput.value.trim().replace(/^https?:\/\//,'').replace(/^www\./,'');
      if(!domain)return alert('Please enter a domain');

      loading.style.display='block';
      resultBox.style.display='none';

      await fetchWhois(domain);
      await checkDNSGlobal(domain,recordType.value);

      loading.style.display='none';
      resultBox.style.display='block';
    }

    async function fetchWhois(domain){
      try{
        const res=await fetch(`https://rdap.org/domain/${domain}`);
        const data=await res.json();

        document.getElementById('whoisDomain').textContent=domain;
        const registrar=(data.entities||[]).find(e=>(e.roles||[]).includes('registrar'));
        document.getElementById('whoisRegistrar').textContent=registrar?(registrar.vcardArray?registrar.vcardArray[1].find(i=>i[0]==='fn')[3]:registrar.handle):'N/A';

        const created=(data.events.find(e=>/registration/i.test(e.eventAction))||{}).eventDate||data.created;
        const updated=(data.events.find(e=>/last/i.test(e.eventAction))||{}).eventDate||data.updated;
        const expiry=(data.events.find(e=>/expir/i.test(e.eventAction))||{}).eventDate||data.expires;

        document.getElementById('whoisCreated').textContent=created?new Date(created).toISOString().split('T')[0]:'‚Äî';
        document.getElementById('whoisUpdated').textContent=updated?new Date(updated).toISOString().split('T')[0]:'‚Äî';
        document.getElementById('whoisExpires').textContent=expiry?new Date(expiry).toISOString().split('T')[0]:'‚Äî';
        document.getElementById('whoisStatus').textContent=(data.status||[]).join(', ')||'Unknown';
      }catch(err){
        document.querySelector('.whois-section').innerHTML='<p style="color:#ff4c4c;">‚ùå WHOIS data not available for this domain.</p>';
      }
    }

    async function checkDNSGlobal(domain,type){
      const table=document.getElementById('dnsTable');
      table.innerHTML='<tr><th>Country</th><th>Status</th><th>IP/Value</th><th>TTL</th></tr>';

      if(!map){map=L.map('map').setView([20,0],2);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);}else{map.eachLayer(l=>{if(l._url===undefined)map.removeLayer(l);});L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);}

      let success=0,fail=0;

      for(const c of countries){
        try{
          const res=await fetch(`https://dns.google/resolve?name=${domain}&type=${type}`);
          const data=await res.json();
          const ans=(data.Answer||[])[0];
          const status=ans?'ok':'fail';
          const icon=status==='ok'?'<span class="ok-icon">‚úî</span>':'<span class="fail-icon">‚úñ</span>';
          const ip=ans?ans.data:'‚Äî';
          const ttl=ans?ans.TTL:'‚Äî';

          const row=document.createElement('tr');
          row.innerHTML=`<td>${c.name}</td><td>${icon}</td><td>${ip}</td><td>${ttl}</td>`;
          table.appendChild(row);

          const markerColor=status==='ok'?'#00ff9c':'#ff4c4c';
          const circle=L.circleMarker([c.lat,c.lon],{color:markerColor,fillColor:markerColor,fillOpacity:0.8,radius:8}).addTo(map);
          circle.bindPopup(`<b>${c.name}</b><br>Status: ${status==='ok'?'‚úÖ Working':'‚ùå Down'}<br>${ip!== '‚Äî'?`IP: ${ip}`:''}`);

          status==='ok'?success++:fail++;
        }catch{fail++}
      }

      const total=countries.length;
      document.getElementById('totalCountries').textContent=total;
      document.getElementById('workingCount').textContent=success;
      document.getElementById('failedCount').textContent=fail;
      const rate=Math.round((success/total)*100);
      document.getElementById('successRate').textContent=rate+'%';

      createChart(success,fail);
    }

    function createChart(success,fail){
      const ctx=document.getElementById('dnsChart');
      new Chart(ctx,{type:'pie',data:{labels:['Working','Failed'],datasets:[{data:[success,fail],backgroundColor:['#00ff9c','#ff4c4c']}]},options:{plugins:{legend:{labels:{color:'#fff'}}}}});
    }

    lookupBtn.addEventListener('click',lookupDomain);
    domainInput.addEventListener('keypress',e=>{if(e.key==='Enter')lookupDomain();});
  </script>
</body>
</html>
