<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Image Text Editor — Sample & Replace</title>
  <style>
    :root{--bg:#f6f7fb}
    body{font-family:Inter,system-ui,Arial;background:var(--bg);margin:0;padding:18px;color:#0b1220}
    .wrap{max-width:1100px;margin:0 auto;display:grid;grid-template-columns:360px 1fr;gap:18px}
    .panel{background:#fff;border-radius:12px;padding:14px;box-shadow:0 4px 18px rgba(12,20,40,0.06)}
    h2{margin:6px 0 12px;font-size:16px}
    label{display:block;font-size:13px;margin:8px 0 6px}
    input[type=file]{width:100%}
    select,input[type=text],input[type=number]{width:100%;padding:8px;border-radius:8px;border:1px solid #e6e9ef}
    button{padding:8px 10px;border-radius:8px;border:0;background:#2563eb;color:#fff;cursor:pointer}
    #canvasWrap{display:flex;align-items:center;justify-content:center;background:#e9eefb;border-radius:12px;padding:12px}
    canvas{max-width:100%;height:auto;border:1px solid #d6dbe8;border-radius:6px;cursor:crosshair}
    .row{display:flex;gap:8px}
    .muted{color:#6b7280;font-size:13px}
    .color-box{width:36px;height:36px;border-radius:6px;border:1px solid #cfd8ef}
    .footer{margin-top:10px;color:#374151;font-size:13px}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <h2>Image · Text Replacer</h2>
      <label>1) Upload image</label>
      <input id="file" type="file" accept="image/*">

      <label>2) Text to place</label>
      <input id="textInput" type="text" placeholder="নতুন লেখা লিখুন — type new text">

      <label>3) Font & size</label>
      <div class="row">
        <select id="fontSelect">
          <option value="48px sans-serif">Sans (default)</option>
          <option value="48px Arial">Arial</option>
          <option value="48px 'Times New Roman'">Times New Roman</option>
          <option value="48px 'Segoe UI'">Segoe UI</option>
          <option value="48px 'Courier New'">Monospace</option>
        </select>
        <input id="fontSize" type="number" min="8" max="300" value="48">
      </div>

      <label>4) Color sampling</label>
      <div class="row" style="align-items:center">
        <button id="sampleBtn">Sample color (click this, then click image)</button>
        <div id="picked" class="color-box" title="Picked color"></div>
        <div id="pickedHex" class="muted">#000000</div>
      </div>

      <label>5) Positioning</label>
      <div class="row">
        <button id="placeBtn">Place text by clicking canvas</button>
        <button id="dragBtn">Drag to move</button>
      </div>

      <div style="margin-top:10px" class="row">
        <button id="drawBtn">Draw text now</button>
        <button id="clearBtn" style="background:#ef4444">Clear overlays</button>
        <button id="downloadBtn" style="background:#10b981">Download PNG</button>
      </div>

      <div class="footer">
        <div>Instructions: ছবিতে ক্লিক করে কালার স্যাম্পল নিন, টেক্সট লিখুন, ফন্ট সাইজ ঠিক করুন, তারপর ছবিতে ক্লিক করে টেক্সট বসান বা ড্র্যাগ করে মুভ করান।</div>
      </div>
    </div>

    <div id="canvasPanel" class="panel" style="min-height:420px">
      <h2>Canvas / Preview</h2>
      <div id="canvasWrap">
        <canvas id="canvas" width="900" height="600"></canvas>
      </div>
      <div style="margin-top:8px;display:flex;gap:10px;align-items:center">
        <div class="muted">Click image to sample color or place text.</div>
      </div>
    </div>
  </div>

<script>
(() => {
  const fileIn = document.getElementById('file');
  const canvas = document.getElementById('canvas');
  const ctx = canvas.getContext('2d');
  const textInput = document.getElementById('textInput');
  const sampleBtn = document.getElementById('sampleBtn');
  const picked = document.getElementById('picked');
  const pickedHex = document.getElementById('pickedHex');
  const drawBtn = document.getElementById('drawBtn');
  const clearBtn = document.getElementById('clearBtn');
  const downloadBtn = document.getElementById('downloadBtn');
  const fontSelect = document.getElementById('fontSelect');
  const fontSize = document.getElementById('fontSize');
  const placeBtn = document.getElementById('placeBtn');
  const dragBtn = document.getElementById('dragBtn');

  let img = new Image();
  let scale = 1;
  let sampleMode = false;
  let placeMode = false;
  let dragMode = false;
  let overlayTexts = []; // {text,x,y,font,color}
  let currentDrag = null;

  function fitCanvasToImage() {
    if (!img.width) return;
    const maxW = Math.max(300, Math.min(1200, window.innerWidth - 420));
    const maxH = 800;
    scale = Math.min(maxW / img.width, maxH / img.height, 1);
    canvas.width = Math.round(img.width * scale);
    canvas.height = Math.round(img.height * scale);
    drawAll();
  }

  function drawAll() {
    ctx.clearRect(0,0,canvas.width,canvas.height);
    if (img && img.width) ctx.drawImage(img,0,0,canvas.width,canvas.height);
    overlayTexts.forEach(o=>{
      ctx.font = o.font;
      ctx.fillStyle = o.color;
      ctx.textBaseline = 'top';
      ctx.fillText(o.text, o.x, o.y);
    });
  }

  fileIn.addEventListener('change', e=>{
    const f = e.target.files && e.target.files[0];
    if (!f) return;
    const url = URL.createObjectURL(f);
    img = new Image();
    img.onload = () => { fitCanvasToImage(); URL.revokeObjectURL(url); };
    img.src = url;
  });

  sampleBtn.addEventListener('click', ()=>{
    sampleMode = true; placeMode = false; dragMode=false;
    sampleBtn.textContent = 'Click image to sample color... (Esc to cancel)';
  });

  placeBtn.addEventListener('click', ()=>{
    placeMode = true; sampleMode=false; dragMode=false;
    placeBtn.textContent = 'Click canvas to place text';
  });

  dragBtn.addEventListener('click', ()=>{
    dragMode = true; sampleMode=false; placeMode=false;
    dragBtn.textContent = 'Drag to move enabled';
  });

  canvas.addEventListener('mousedown', (e)=>{
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left);
    const y = (e.clientY - rect.top);

    if (sampleMode) {
      const p = ctx.getImageData(x, y, 1, 1).data;
      const hex = rgbToHex(p[0],p[1],p[2]);
      picked.style.background = hex;
      pickedHex.textContent = hex;
      sampleMode = false;
      sampleBtn.textContent = 'Sample color (click this, then click image)';
      return;
    }

    if (placeMode) {
      const text = textInput.value || 'Text';
      const font = (fontSize.value||48) + 'px ' + fontSelect.options[fontSelect.selectedIndex].text.replace(/\"/g,'');
      const color = pickedHex.textContent || '#000000';
      overlayTexts.push({text, x, y, font, color});
      drawAll();
      placeMode=false;
      placeBtn.textContent = 'Place text by clicking canvas';
      return;
    }

    if (dragMode) {
      // find topmost overlay near click
      for (let i=overlayTexts.length-1;i>=0;i--) {
        const o = overlayTexts[i];
        ctx.font = o.font;
        const w = ctx.measureText(o.text).width;
        const h = parseInt(o.font)||48;
        if (x >= o.x && x <= o.x + w && y >= o.y && y <= o.y + h) {
          currentDrag = {index:i, offsetX: x - o.x, offsetY: y - o.y};
          break;
        }
      }
    }
  });

  canvas.addEventListener('mousemove',(e)=>{
    if (!currentDrag) return;
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left);
    const y = (e.clientY - rect.top);
    const o = overlayTexts[currentDrag.index];
    o.x = x - currentDrag.offsetX;
    o.y = y - currentDrag.offsetY;
    drawAll();
  });

  window.addEventListener('mouseup', ()=>{ currentDrag = null; });

  drawBtn.addEventListener('click', ()=>{
    // draws current typed text at top-left if none placed
    const text = textInput.value || 'Text';
    const font = (fontSize.value||48) + 'px ' + fontSelect.options[fontSelect.selectedIndex].text.replace(/\"/g,'');
    const color = pickedHex.textContent || '#000000';
    overlayTexts.push({text, x:20, y:20, font, color});
    drawAll();
  });

  clearBtn.addEventListener('click', ()=>{
    overlayTexts = []; drawAll();
  });

  downloadBtn.addEventListener('click', ()=>{
    const link = document.createElement('a');
    link.download = 'edited-image.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  });

  // cancel keys
  window.addEventListener('keydown',(e)=>{
    if (e.key === 'Escape') { sampleMode=false; placeMode=false; dragMode=false; sampleBtn.textContent='Sample color (click this, then click image)'; placeBtn.textContent='Place text by clicking canvas'; dragBtn.textContent='Drag to move'; }
  });

  function componentToHex(c) { const hex = c.toString(16); return hex.length == 1 ? '0' + hex : hex; }
  function rgbToHex(r,g,b) { return '#' + componentToHex(r) + componentToHex(g) + componentToHex(b); }

  // responsive: redraw if window resize
  window.addEventListener('resize', ()=>{ fitCanvasToImage(); });

  // initialize blank canvas
  ctx.fillStyle = '#ffffff'; ctx.fillRect(0,0,canvas.width,canvas.height);
})();
</script>
</body>
</html>
