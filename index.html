<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üåé Global DNS & Domain Analyzer</title>
  <style>
    body {font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#000428,#004e92);color:#fff;margin:0;padding:0;}
    .container {max-width:1200px;margin:50px auto;padding:40px;background:rgba(255,255,255,0.08);border-radius:20px;box-shadow:0 0 40px rgba(0,255,255,0.3);} 
    h1{text-align:center;color:#00eaff;text-shadow:0 0 20px #00eaff;}
    p{text-align:center;color:#ccc;margin-bottom:30px;}
    .input-group{display:flex;justify-content:center;gap:10px;margin-bottom:20px;}
    input,select{padding:12px;border:none;border-radius:10px;outline:none;font-size:16px;background:rgba(255,255,255,0.1);color:#fff;}
    button{background:linear-gradient(45deg,#00eaff,#ff00c3);border:none;border-radius:10px;padding:12px 20px;color:#000;font-weight:bold;cursor:pointer;transition:0.3s;}
    button:hover{transform:scale(1.05);}
    .loading{text-align:center;color:#00eaff;display:none;margin:10px;}
    .result{background:rgba(0,0,0,0.6);border-radius:15px;padding:25px;margin-top:20px;}
    .info-row{display:flex;justify-content:space-between;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.1);} 
    .info-row span{color:#00eaff;}
    #validDays{color:#ffdd57;font-weight:bold;}
    #map{width:100%;height:400px;border-radius:10px;margin-top:20px;}
    #dnsTable{width:100%;border-collapse:collapse;margin-top:20px;}
    #dnsTable th,#dnsTable td{border:1px solid rgba(255,255,255,0.2);padding:8px;text-align:left;}
    #dnsTable th{background:rgba(255,255,255,0.1);}
  </style>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <div class="container">
    <h1>üåê Global DNS & Domain Analyzer</h1>
    <p>Check domain WHOIS, global DNS propagation, and IP locations visually on map</p>

    <div class="input-group">
      <input id="domainInput" type="text" placeholder="Enter domain e.g. example.com">
      <select id="recordType">
        <option value="A">A</option>
        <option value="AAAA">AAAA</option>
        <option value="CNAME">CNAME</option>
        <option value="MX">MX</option>
        <option value="NS">NS</option>
        <option value="TXT">TXT</option>
      </select>
      <button id="lookupBtn">Search</button>
    </div>

    <div class="loading" id="loading">üîç Fetching domain & DNS info...</div>

    <div id="result" class="result" style="display:none">
      <div class="info-row"><strong>Domain:</strong> <span id="domain"></span></div>
      <div class="info-row"><strong>Registrar:</strong> <span id="registrar"></span></div>
      <div class="info-row"><strong>Created:</strong> <span id="created"></span></div>
      <div class="info-row"><strong>Expires:</strong> <span id="expiry"></span></div>
      <div class="info-row"><strong>Days Valid:</strong> <span id="validDays"></span></div>
      <div class="info-row"><strong>Status:</strong> <span id="status"></span></div>
      <div id="map"></div>
      <table id="dnsTable"></table>
    </div>
  </div>

  <script>
    const lookupBtn = document.getElementById('lookupBtn');
    const recordType = document.getElementById('recordType');
    const domainInput = document.getElementById('domainInput');
    const loading = document.getElementById('loading');
    const resultBox = document.getElementById('result');
    let map;

    async function lookupDomain(){
      const domain = domainInput.value.trim().replace(/^https?:\/\//,'').replace(/^www\./,'');
      if(!domain) return alert('Please enter a domain');

      loading.style.display='block';
      resultBox.style.display='none';

      try{
        const rdapRes = await fetch(`https://rdap.org/domain/${domain}`);
        const rdap = await rdapRes.json();

        document.getElementById('domain').textContent = domain;
        const registrar = (rdap.entities||[]).find(e => (e.roles||[]).includes('registrar'));
        document.getElementById('registrar').textContent = registrar ? (registrar.vcardArray ? registrar.vcardArray[1].find(i=>i[0]==='fn')[3] : registrar.handle) : 'N/A';

        const created = (rdap.events.find(e=>/registration/i.test(e.eventAction))||{}).eventDate || rdap.created;
        const expiry = (rdap.events.find(e=>/expir/i.test(e.eventAction))||{}).eventDate || rdap.expires;
        document.getElementById('created').textContent = created ? new Date(created).toISOString().split('T')[0] : '‚Äî';
        document.getElementById('expiry').textContent = expiry ? new Date(expiry).toISOString().split('T')[0] : '‚Äî';

        const validDays = calcDaysValid(expiry);
        document.getElementById('validDays').textContent = validDays + ' days';
        document.getElementById('status').textContent = (rdap.status||[]).join(', ') || 'Unknown';

        await fetchDNS(domain,recordType.value);

        loading.style.display='none';
        resultBox.style.display='block';
      }catch(err){
        loading.style.display='none';
        alert('Error fetching: '+err.message);
      }
    }

    async function fetchDNS(domain,type){
      const res = await fetch(`https://dns.google/resolve?name=${domain}&type=${type}`);
      const data = await res.json();
      const answers = data.Answer || [];
      const table = document.getElementById('dnsTable');
      table.innerHTML = '<tr><th>Record Type</th><th>IP/Value</th><th>TTL</th><th>Geo</th></tr>';

      if(!map){map=L.map('map').setView([20,0],2);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);} else {map.eachLayer(l=>{if(l._url===undefined)map.removeLayer(l);});L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);}

      for(const ans of answers){
        const ip=ans.data;
        const ttl=ans.TTL;
        const tr=document.createElement('tr');
        tr.innerHTML=`<td>${ans.type}</td><td>${ip}</td><td>${ttl}</td><td id="geo-${ip}">Loading...</td>`;
        table.appendChild(tr);
        geoLocate(ip);
      }
    }

    async function geoLocate(ip){
      try{
        const res=await fetch(`https://ipapi.co/${ip}/json/`);
        const loc=await res.json();
        const el=document.getElementById(`geo-${ip}`);
        if(loc && loc.latitude){
          el.textContent=`${loc.city||''}, ${loc.country_name||''}`;
          L.marker([loc.latitude,loc.longitude]).addTo(map).bindPopup(`${ip}<br>${loc.city||''}, ${loc.country_name||''}`);
        } else el.textContent='Unknown';
      }catch(e){
        const el=document.getElementById(`geo-${ip}`);
        el.textContent='‚Äî';
      }
    }

    function calcDaysValid(expiry){const diff=new Date(expiry)-new Date();return diff>0?Math.round(diff/(1000*60*60*24)):0;}

    lookupBtn.addEventListener('click',lookupDomain);
    domainInput.addEventListener('keypress',e=>{if(e.key==='Enter')lookupDomain();});
  </script>
</body>
</html>
