<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üåç Full WHOIS + DNS + Map Analyzer</title>
  <style>
    body {font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#0f0c29,#302b63,#24243e);color:#fff;margin:0;padding:0;}
    .container {max-width:1300px;margin:50px auto;padding:40px;background:rgba(255,255,255,0.08);border-radius:20px;box-shadow:0 0 40px rgba(0,255,255,0.3);} 
    h1{text-align:center;color:#00eaff;text-shadow:0 0 25px #00eaff;margin-bottom:10px;}
    p{text-align:center;color:#ccc;margin-bottom:30px;}
    .input-group{display:flex;justify-content:center;gap:10px;margin-bottom:20px;}
    input,select{padding:12px;border:none;border-radius:10px;outline:none;font-size:16px;background:rgba(255,255,255,0.1);color:#fff;}
    select{background:linear-gradient(45deg,#ff007a,#00eaff);font-weight:bold;text-shadow:0 0 5px rgba(0,0,0,0.4);cursor:pointer;transition:0.3s;}
    select:hover{box-shadow:0 0 15px #00eaff;transform:scale(1.05);}
    button{background:linear-gradient(45deg,#00eaff,#ff00c3);border:none;border-radius:10px;padding:12px 20px;color:#000;font-weight:bold;cursor:pointer;transition:0.3s;}
    button:hover{transform:scale(1.05);box-shadow:0 0 20px #00eaff;}
    .loading{text-align:center;color:#00eaff;display:none;margin:15px;}

    /* WHOIS Section */
    .whois-section{background:linear-gradient(135deg,#1a2a6c,#b21f1f,#fdbb2d);padding:25px;border-radius:15px;color:#fff;text-shadow:0 0 10px rgba(0,0,0,0.5);}
    .whois-section h2{text-align:center;font-size:26px;margin-bottom:15px;color:#fff;text-shadow:0 0 15px #000;}
    .whois-grid{display:grid;grid-template-columns:1fr 1fr;gap:15px;}
    .whois-item{background:rgba(0,0,0,0.3);padding:15px;border-radius:10px;box-shadow:0 0 10px rgba(0,0,0,0.3);} 
    .whois-item strong{color:#ffdd57;}

    /* Map and Chart Section */
    #map{width:100%;height:450px;border-radius:15px;margin-top:30px;}
    #dnsTable{width:100%;border-collapse:collapse;margin-top:20px;text-align:center;}
    #dnsTable th,#dnsTable td{border:1px solid rgba(255,255,255,0.2);padding:10px;}
    #dnsTable th{background:rgba(255,255,255,0.15);color:#00eaff;}
    .chart-container{text-align:center;margin-top:20px;}

    iframe{width:100%;height:300px;border-radius:15px;border:none;box-shadow:0 0 15px rgba(0,0,0,0.5);margin-top:20px;}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
</head>
<body>
  <div class="container">
    <h1>üåê WHOIS + DNS + Map Analyzer</h1>
    <p>View WHOIS details, DNS propagation map, country-based checks, and live site preview in one place.</p>

    <div class="input-group">
      <input id="domainInput" type="text" placeholder="Enter domain e.g. example.com">
      <select id="recordType">
        <option value="A">A</option>
        <option value="AAAA">AAAA</option>
        <option value="CNAME">CNAME</option>
        <option value="MX">MX</option>
        <option value="NS">NS</option>
        <option value="TXT">TXT</option>
      </select>
      <button id="lookupBtn">Search</button>
    </div>

    <div class="loading" id="loading">üîç Fetching WHOIS and DNS data...</div>

    <div id="whoisSection" class="whois-section" style="display:none">
      <h2>üîé WHOIS Information</h2>
      <div class="whois-grid">
        <div class="whois-item"><strong>Registrar:</strong> <span id="whoisRegistrar">‚Äî</span></div>
        <div class="whois-item"><strong>Registrar Status:</strong> <span id="whoisRegStatus">‚Äî</span></div>
        <div class="whois-item"><strong>Name Servers:</strong> <span id="whoisNS">‚Äî</span></div>
        <div class="whois-item"><strong>IP Address:</strong> <span id="whoisIP">‚Äî</span></div>
        <div class="whois-item"><strong>IP History:</strong> <span id="whoisIPHistory">‚Äî</span></div>
        <div class="whois-item"><strong>ASN:</strong> <span id="whoisASN">‚Äî</span></div>
        <div class="whois-item"><strong>Domain Status:</strong> <span id="whoisStatus">‚Äî</span></div>
        <div class="whois-item"><strong>Hosting History:</strong> <span id="whoisHosting">‚Äî</span></div>
      </div>
      <iframe id="sitePreview" src=""></iframe>
    </div>

    <div id="dnsSection" style="display:none">
      <h2>üåç DNS Map & Country Check</h2>
      <div class="chart-container"><canvas id="dnsChart"></canvas></div>
      <div id="map"></div>
      <table id="dnsTable"></table>
    </div>
  </div>

  <script>
    const lookupBtn=document.getElementById('lookupBtn');
    const loading=document.getElementById('loading');
    const whoisSection=document.getElementById('whoisSection');
    const dnsSection=document.getElementById('dnsSection');
    let map;

    const countries=[{name:'United States',lat:37.09,lon:-95.71},{name:'United Kingdom',lat:55.37,lon:-3.43},{name:'Germany',lat:51.16,lon:10.45},{name:'India',lat:20.59,lon:78.96},{name:'Brazil',lat:-14.23,lon:-51.92},{name:'Australia',lat:-25.27,lon:133.77},{name:'Japan',lat:36.20,lon:138.25},{name:'France',lat:46.22,lon:2.21},{name:'Canada',lat:56.13,lon:-106.34},{name:'South Africa',lat:-30.55,lon:22.93}];

    async function lookupDomain(){
      const domain=document.getElementById('domainInput').value.trim().replace(/^https?:\/\//,'').replace(/^www\./,'');
      if(!domain)return alert('Please enter a domain');

      loading.style.display='block';
      whoisSection.style.display='none';
      dnsSection.style.display='none';

      await fetchWhois(domain);
      await checkDNSGlobal(domain,document.getElementById('recordType').value);

      loading.style.display='none';
      whoisSection.style.display='block';
      dnsSection.style.display='block';
    }

    async function fetchWhois(domain){
      try{
        const res=await fetch(`https://rdap.org/domain/${domain}`);
        const data=await res.json();

        document.getElementById('whoisRegistrar').textContent=(data.entities||[]).find(e=>(e.roles||[]).includes('registrar'))?.vcardArray?.[1]?.find(i=>i[0]==='fn')?.[3]||'N/A';
        document.getElementById('whoisRegStatus').textContent=(data.status||[]).join(', ')||'Active';
        document.getElementById('whoisNS').textContent=(data.nameservers||[]).map(ns=>ns.ldhName).join(', ')||'‚Äî';
        document.getElementById('whoisStatus').textContent=(data.status||[]).join(', ')||'Unknown';

        const ipRes=await fetch(`https://ipapi.co/${domain}/json/`);
        const ipData=await ipRes.json();
        document.getElementById('whoisIP').textContent=ipData.ip||'‚Äî';
        document.getElementById('whoisASN').textContent=ipData.asn||'‚Äî';
        document.getElementById('whoisHosting').textContent=ipData.org||'‚Äî';
        document.getElementById('whoisIPHistory').textContent='Historical IP data unavailable in demo';

        document.getElementById('sitePreview').src='https://'+domain;
      }catch(err){
        alert('WHOIS fetch error: '+err.message);
      }
    }

    async function checkDNSGlobal(domain,type){
      const table=document.getElementById('dnsTable');
      table.innerHTML='<tr><th>Country</th><th>Status</th><th>IP</th><th>TTL</th></tr>';

      if(!map){map=L.map('map').setView([20,0],2);L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);}else{map.eachLayer(l=>{if(l._url===undefined)map.removeLayer(l);});L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);}

      let success=0,fail=0;
      for(const c of countries){
        try{
          const res=await fetch(`https://dns.google/resolve?name=${domain}&type=${type}`);
          const data=await res.json();
          const ans=(data.Answer||[])[0];
          const status=ans?'ok':'fail';
          const ip=ans?ans.data:'‚Äî';
          const ttl=ans?ans.TTL:'‚Äî';
          const icon=status==='ok'?'‚úÖ':'‚ùå';

          const row=document.createElement('tr');
          row.innerHTML=`<td>${c.name}</td><td>${icon}</td><td>${ip}</td><td>${ttl}</td>`;
          table.appendChild(row);

          const color=status==='ok'?'#00ff9c':'#ff4c4c';
          const marker=L.circleMarker([c.lat,c.lon],{color:color,fillColor:color,fillOpacity:0.8,radius:8}).addTo(map);
          marker.bindPopup(`<b>${c.name}</b><br>${status==='ok'?'Working ‚úÖ':'Failed ‚ùå'}<br>${ip}`);
          status==='ok'?success++:fail++;
        }catch{fail++;}
      }

      const ctx=document.getElementById('dnsChart').getContext('2d');
      new Chart(ctx,{type:'pie',data:{labels:['Working','Failed'],datasets:[{data:[success,fail],backgroundColor:['#00ff9c','#ff4c4c']}]},options:{plugins:{legend:{labels:{color:'#fff'}}}}});
    }

    lookupBtn.addEventListener('click',lookupDomain);
    document.getElementById('domainInput').addEventListener('keypress',e=>{if(e.key==='Enter')lookupDomain();});
  </script>
</body>
</html>
