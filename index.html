<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>üîí Full Security WHOIS & DNS Dashboard</title>
  <style>
    :root{--bg-1:#0f1724;--card:#061025;--accent:#00eaff;--accent2:#ff4ecf;--good:#00ff9c;--bad:#ff4c4c}
    body{margin:0;font-family:Inter, Poppins, system-ui, -apple-system, 'Segoe UI', Roboto;background:linear-gradient(180deg,#071025 0%, #081226 100%);color:#e6eef8}
    .wrap{max-width:1200px;margin:28px auto;padding:22px}
    .head{display:flex;align-items:center;justify-content:space-between;gap:16px}
    h1{margin:0;font-size:20px;color:var(--accent)}
    p.lead{margin:6px 0 18px;color:#99a7bb}

    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:14px;box-shadow:0 8px 30px rgba(2,6,23,.6)}
    .controls{display:flex;gap:10px;align-items:center}
    input[type=text]{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit;min-width:260px}
    select{padding:10px;border-radius:10px;border:1px solid rgba(255,255,255,0.04);background:linear-gradient(90deg,var(--accent),var(--accent2));color:#00121a;font-weight:700}
    button{padding:10px 12px;border-radius:10px;border:0;background:linear-gradient(90deg,var(--accent),var(--accent2));color:#00121a;font-weight:700;cursor:pointer}

    .layout{display:grid;grid-template-columns:1fr 420px;gap:16px;margin-top:16px}
    @media (max-width:980px){.layout{grid-template-columns:1fr}}

    /* left */
    .left .section{margin-bottom:14px}
    .whois-card{padding:14px;border-radius:12px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));}
    .whois-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .whois-item{background:rgba(0,0,0,0.45);padding:10px;border-radius:8px}
    .whois-item .k{color:#9fb4c8;font-size:13px}
    .whois-item .v{font-weight:700;margin-top:6px}

    .dates{display:flex;gap:10px;flex-wrap:wrap}
    .date-pill{background:linear-gradient(90deg,#111827,#0b1220);padding:12px;border-radius:10px;min-width:160px}
    .date-pill .big{font-weight:800;font-size:18px}
    .meta-small{color:#9fb4c8;font-size:13px}

    .score{display:flex;align-items:center;gap:12px}
    .gauge{height:10px;background:rgba(255,255,255,0.06);border-radius:999px;overflow:hidden;width:220px}
    .gauge > i{display:block;height:100%;background:linear-gradient(90deg,var(--good),#ffd166);width:0%}

    /* DNS / map */
    #map{height:360px;border-radius:10px;margin-top:12px}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left}

    /* right */
    .right .sidebar-item{margin-bottom:12px}
    .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:rgba(255,255,255,0.03);color:var(--accent);font-weight:700}

    .virus-box{padding:12px;border-radius:10px;background:linear-gradient(90deg,#2b0b27,#0b1830);}
    .export-row{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}

    footer{margin-top:18px;color:#8f9fb3;font-size:13px}
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <div>
        <h1>üîê Full Security WHOIS & DNS Dashboard</h1>
        <p class="lead">All previous functions + Authority score, Dates panel, IP history, ASN, Hosting history, Virus/Blacklist check and live preview.</p>
      </div>
      <div class="controls card">
        <input id="domainInput" type="text" placeholder="example.com" value="example.com" />
        <select id="recordType"><option>A</option><option>AAAA</option><option>CNAME</option><option>MX</option><option>NS</option><option>TXT</option></select>
        <button id="lookupBtn">Lookup</button>
      </div>
    </div>

    <div class="layout">
      <div class="left">
        <div class="section whois-card card">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="meta-small">WHOIS</div>
              <h2 id="domainTitle">‚Äî</h2>
            </div>
            <div class="badge" id="authorityBadge">Score: ‚Äî</div>
          </div>

          <div style="margin-top:12px" class="whois-grid">
            <div class="whois-item"><div class="k">Registrar</div><div class="v" id="whoisRegistrar">‚Äî</div></div>
            <div class="whois-item"><div class="k">Registrar Status</div><div class="v" id="whoisRegStatus">‚Äî</div></div>
            <div class="whois-item"><div class="k">Name Servers</div><div class="v" id="whoisNS">‚Äî</div></div>
            <div class="whois-item"><div class="k">Domain Status</div><div class="v" id="whoisStatus">‚Äî</div></div>
            <div class="whois-item"><div class="k">ASN</div><div class="v" id="whoisASN">‚Äî</div></div>
            <div class="whois-item"><div class="k">IP Address</div><div class="v" id="whoisIP">‚Äî</div></div>
            <div class="whois-item"><div class="k">IP History</div><div class="v" id="whoisIPHistory">‚Äî</div></div>
            <div class="whois-item"><div class="k">Hosting History</div><div class="v" id="whoisHosting">‚Äî</div></div>
          </div>

          <div style="margin-top:14px;display:flex;gap:12px;align-items:center;flex-wrap:wrap">
            <div class="dates">
              <div class="date-pill">
                <div class="meta-small">Created</div>
                <div class="big" id="createdDate">‚Äî</div>
              </div>
              <div class="date-pill">
                <div class="meta-small">Updated</div>
                <div class="big" id="updatedDate">‚Äî</div>
              </div>
              <div class="date-pill">
                <div class="meta-small">Expires</div>
                <div class="big" id="expiresDate">‚Äî</div>
              </div>
            </div>

            <div style="min-width:180px">
              <div class="meta-small">Age</div>
              <div style="font-size:18px;font-weight:800" id="ageDays">‚Äî</div>
              <div style="margin-top:8px" class="score">
                <div class="gauge"><i id="gaugeBar" style="width:0%"></i></div>
                <div id="scoreText">‚Äî / 100</div>
              </div>
            </div>
          </div>

        </div>

        <div class="section card">
          <h3 style="margin:0 0 8px 0">üîé Virus / Blacklist Check</h3>
          <div class="virus-box">
            <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
              <input id="vtKey" type="text" placeholder="Paste VirusTotal API key (optional)" style="flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit" />
              <button id="checkVirus">Run Check</button>
            </div>
            <div style="margin-top:12px" id="virusResult">No scan performed yet.</div>
          </div>
        </div>

        <div class="section card">
          <h3 style="margin:0 0 8px 0">üåê DNS Results & Table</h3>
          <div id="map" class="card"></div>
          <table id="dnsTable"><thead><tr><th>Country</th><th>Status</th><th>IP / Value</th><th>TTL</th></tr></thead><tbody></tbody></table>
        </div>

      </div>

      <div class="right">
        <div class="card sidebar-item">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <div class="meta-small">Summary</div>
              <h3 id="summaryDomain">‚Äî</h3>
            </div>
            <div style="text-align:right">
              <div class="meta-small">Success</div>
              <div id="successRate" style="font-weight:800;color:var(--accent)">‚Äî</div>
            </div>
          </div>

          <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
            <button id="exportCSV">Export CSV</button>
            <button id="exportPDF">Export PDF</button>
            <button id="refreshBtn">Refresh</button>
          </div>
        </div>

        <div class="card sidebar-item">
          <h4 style="margin:0 0 8px 0">Preview</h4>
          <iframe id="sitePreview" src="about:blank"></iframe>
        </div>

        <div class="card sidebar-item">
          <h4 style="margin:0 0 8px 0">Quick Checks</h4>
          <div style="display:flex;gap:8px;flex-wrap:wrap">
            <button id="checkSSL">SSL Check</button>
            <button id="whoisRaw">Show Raw WHOIS JSON</button>
            <button id="clearBtn">Clear</button>
          </div>
          <pre id="rawOutput" style="margin-top:8px;display:none;background:#021124;padding:8px;border-radius:8px;max-height:220px;overflow:auto"></pre>
        </div>
      </div>
    </div>

    <footer>Tip: Provide a VirusTotal API key for deeper blacklist scanning. Some checks need server-side proxy for CORS.</footer>
  </div>

  <script>
    // Helper functions
    const $ = id => document.getElementById(id);
    const domainInput = $('domainInput');
    const lookupBtn = $('lookupBtn');
    const recordType = $('recordType');
    const loading = $('loading');

    // Map init
    let map = null; let markers = [];
    function initMap(){
      if(map) return;
      map = L.map('map').setView([20,0],2);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{maxZoom:19}).addTo(map);
    }

    function clearMarkers(){ markers.forEach(m=>map.removeLayer(m)); markers=[] }

    function formatDate(d){ try{ if(!d) return '‚Äî'; const dt=new Date(d); if(isNaN(dt)) return d; return dt.toISOString().split('T')[0]; }catch(e){return d} }
    function daysBetween(d1,d2){ return Math.round((d2 - new Date(d1))/(1000*60*60*24)) }

    async function lookupDomain(){
      const domain = domainInput.value.trim().replace(/^https?:\/\//,'').replace(/^www\./,'');
      if(!domain) { alert('Enter domain'); return }

      loading.style.display='block';

      // Clear UI
      $('domainTitle').textContent = domain;
      $('summaryDomain').textContent = domain;
      $('whoisRegistrar').textContent='‚Äî'; $('whoisRegStatus').textContent='‚Äî'; $('whoisNS').textContent='‚Äî'; $('whoisStatus').textContent='‚Äî';
      $('whoisASN').textContent='‚Äî'; $('whoisIP').textContent='‚Äî'; $('whoisIPHistory').textContent='‚Äî'; $('whoisHosting').textContent='‚Äî';
      $('createdDate').textContent='‚Äî'; $('updatedDate').textContent='‚Äî'; $('expiresDate').textContent='‚Äî'; $('ageDays').textContent='‚Äî';
      $('scoreText').textContent='‚Äî / 100'; $('gaugeBar').style.width='0%'; $('authorityBadge').textContent='Score: ‚Äî';
      $('virusResult').textContent='No scan performed yet.';
      $('sitePreview').src = '';
      $('rawOutput').style.display='none';

      try{
        initMap(); clearMarkers();

        // 1) WHOIS RDAP
        const rdapRes = await fetch(`https://rdap.org/domain/${domain}`);
        if(!rdapRes.ok) throw new Error('RDAP lookup failed');
        const rdap = await rdapRes.json();
        window._rdapRaw = rdap; // store for raw view
        // Registrar
        const registrar = (rdap.entities||[]).find(e=> (e.roles||[]).includes('registrar'));
        $('whoisRegistrar').textContent = registrar ? (registrar.vcardArray?.[1]?.find(i=>i[0]==='fn')?.[3] || registrar.handle) : 'N/A';
        $('whoisRegStatus').textContent = (rdap.status||[]).join(', ') || 'Active';
        $('whoisNS').textContent = (rdap.nameservers||[]).map(n=> typeof n === 'string' ? n : (n.ldhName || n.objectClassName)).join(', ') || '‚Äî';
        $('whoisStatus').textContent = (rdap.status||[]).join(', ') || '‚Äî';

        // dates
        const created = (rdap.events||[]).find(e=>/registration/i.test(e.eventAction))?.eventDate || rdap.created || null;
        const updated = (rdap.events||[]).find(e=>/last/i.test(e.eventAction))?.eventDate || rdap.updated || null;
        const expires = (rdap.events||[]).find(e=>/expir/i.test(e.eventAction))?.eventDate || rdap.expires || null;
        $('createdDate').textContent = formatDate(created);
        $('updatedDate').textContent = formatDate(updated);
        $('expiresDate').textContent = formatDate(expires);

        const age = created ? daysBetween(created, new Date()) : 0;
        $('ageDays').textContent = age + ' days old';

        // 2) Resolve main A records with Google DNS (this gives the current IPs)
        const dnsRes = await fetch(`https://dns.google/resolve?name=${domain}&type=A`);
        const dnsJson = await dnsRes.json();
        const answers = dnsJson.Answer || [];
        const ips = [...new Set(answers.map(a=>a.data))];
        $('whoisIP').textContent = ips.join(', ') || '‚Äî';

        // 3) ASN & IP details via ipapi for first IP
        if(ips.length>0){
          try{
            const ipInfo = await (await fetch(`https://ipapi.co/${ips[0]}/json/`)).json();
            $('whoisASN').textContent = ipInfo.asn || ipInfo.network || '‚Äî';
            $('whoisHosting').textContent = ipInfo.org || '‚Äî';
          }catch(e){/*ignore*/}
        }

        // 4) IP History - placeholder (needs paid API) -> keep demo text
        $('whoisIPHistory').textContent = 'Historical IP data requires external API (e.g., SecurityTrails).';

        // 5) Authority score calc (age, dns stability, ssl)
        // dns stability: if at least one A record -> +30, else 0. age gives up to 40, ssl up to 30
        let score = 10;
        score += Math.min(40, Math.floor(age/30));
        score += ips.length>0 ? 30 : 0;
        // check SSL reachability via allorigins to avoid CORS
        let sslOk = false;
        try{
          const r = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent('https://' + domain)}`,{mode:'cors'});
          if(r.ok) sslOk = true;
        }catch(e){ sslOk = false }
        score += sslOk ? 20 : 0;
        score = Math.max(0, Math.min(100, score));
        $('gaugeBar').style.width = score + '%';
        $('scoreText').textContent = score + ' / 100';
        $('authorityBadge').textContent = 'Score: ' + score;

        // 6) DNS global country checks + map
        const countries = [
          {name:'United States',lat:37.09,lon:-95.71},
          {name:'United Kingdom',lat:55.37,lon:-3.43},
          {name:'Germany',lat:51.16,lon:10.45},
          {name:'India',lat:20.59,lon:78.96},
          {name:'Brazil',lat:-14.23,lon:-51.92},
          {name:'Australia',lat:-25.27,lon:133.77},
          {name:'Japan',lat:36.20,lon:138.25},
          {name:'France',lat:46.22,lon:2.21},
          {name:'Canada',lat:56.13,lon:-106.34},
          {name:'South Africa',lat:-30.55,lon:22.93}
        ];

        initMap(); clearMarkers();
        const tbody = document.querySelector('#dnsTable tbody'); tbody.innerHTML='';
        let success=0,fail=0;
        for(const c of countries){
          // simulate per-country check by using the public DNS resolver ‚Äî in real product use many remote resolvers
          try{
            const r = await fetch(`https://dns.google/resolve?name=${domain}&type=${recordType.value}`);
            const j = await r.json();
            const ans = (j.Answer||[])[0];
            const ok = !!ans;
            const ip = ok ? ans.data : '‚Äî';
            const ttl = ok ? ans.TTL : '‚Äî';
            const tr = document.createElement('tr');
            tr.innerHTML = `<td>${c.name}</td><td>${ok?'<span style=\"color:'+ (ok? 'var(--good)':'var(--bad)')+'\">‚úî</span>':'<span style=\"color:var(--bad)\">‚úñ</span>'}</td><td>${ip}</td><td>${ttl}</td>`;
            tbody.appendChild(tr);

            const color = ok ? '#00ff9c' : '#ff4c4c';
            const m = L.circleMarker([c.lat,c.lon],{radius:8,color:color,fillColor:color,fillOpacity:0.8}).addTo(map);
            m.bindPopup(`<b>${c.name}</b><br>${ok?'Working ‚úÖ':'Failed ‚ùå'}<br>${ip}`);
            markers.push(m);
            if(ok) success++; else fail++;
          }catch(e){
            const tr = document.createElement('tr'); tr.innerHTML = `<td>${c.name}</td><td><span style="color:var(--bad)">‚úñ</span></td><td>‚Äî</td><td>‚Äî</td>`; tbody.appendChild(tr);
            const m = L.circleMarker([c.lat,c.lon],{radius:8,color:'#ff4c4c',fillColor:'#ff4c4c',fillOpacity:0.8}).addTo(map); markers.push(m);
            fail++;
          }
        }

        // chart
        const ctx = document.getElementById('dnsChart').getContext('2d');
        new Chart(ctx,{type:'pie',data:{labels:['Working','Failed'],datasets:[{data:[success,fail],backgroundColor:['#00ff9c','#ff4c4c']}]},options:{plugins:{legend:{labels:{color:'#fff'}}}}});

        $('successRate').textContent = Math.round((success/(success+fail||1))*100) + '%';

        // live preview
        $('sitePreview').src = 'https://' + domain;

      }catch(err){
        alert('Lookup error: ' + err.message);
      }finally{
        loading.style.display='none';
      }
    }

    // VirusTotal (optional) - requires API key
    $('checkVirus').addEventListener('click', async ()=>{
      const domain = domainInput.value.trim().replace(/^https?:\/\//,'').replace(/^www\./,'');
      const key = $('vtKey').value.trim();
      if(!domain) return alert('Enter domain');
      if(!key){ $('virusResult').textContent = 'Provide VirusTotal API key to perform deep scan (or skip to use basic checks).'; return }

      $('virusResult').textContent = 'Scanning...';
      try{
        const res = await fetch('https://www.virustotal.com/api/v3/domains/' + encodeURIComponent(domain), {headers:{'x-apikey': key}});
        if(!res.ok) throw new Error('VirusTotal error: ' + res.statusText);
        const j = await res.json();
        // check last_analysis_stats if present
        const stats = j.data?.attributes?.last_analysis_stats || null;
        if(stats){
          const positives = Object.values(stats).reduce((a,b)=>a+b,0) - (stats.harmless||0);
          $('virusResult').innerHTML = `Detections: <strong>${positives}</strong> ‚Äî <small>${JSON.stringify(stats)}</small>`;
        } else {
          $('virusResult').textContent = 'No analysis stats available.';
        }
      }catch(e){
        $('virusResult').textContent = 'VirusTotal request failed: ' + e.message;
      }
    });

    // quick helpers
    $('whoisRaw').addEventListener('click', ()=>{
      if(window._rdapRaw){ $('rawOutput').style.display='block'; $('rawOutput').textContent = JSON.stringify(window._rdapRaw, null, 2); } else alert('No RDAP data yet');
    });
    $('clearBtn').addEventListener('click', ()=>{ location.reload(); });
    $('refreshBtn').addEventListener('click', ()=>{ lookupDomain(); });

    // exports (CSV)
    $('exportCSV').addEventListener('click', ()=>{
      // collect table
      const rows = [['Country','Status','IP','TTL']];
      document.querySelectorAll('#dnsTable tbody tr').forEach(tr=>{ const cols = [...tr.querySelectorAll('td')].map(td=>td.textContent.trim()); rows.push(cols); });
      const csv = rows.map(r=>r.map(cell=>`"${cell.replace(/"/g,'""')}"`).join(',')).join('\n');
      const blob = new Blob([csv],{type:'text/csv'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download = (domainInput.value||'report') + '_dns.csv'; a.click(); URL.revokeObjectURL(url);
    });

    // SSL quick check
    $('checkSSL').addEventListener('click', async ()=>{
      const domain = domainInput.value.trim().replace(/^https?:\/\//,'').replace(/^www\./,'');
      if(!domain) return alert('Enter domain');
      try{
        const r = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent('https://' + domain)}`);
        if(r.ok) alert('Site reachable over HTTPS ‚Äî SSL appears present'); else alert('HTTPS fetch failed');
      }catch(e){ alert('HTTPS check error: '+e.message) }
    });

    lookupBtn.addEventListener('click', lookupDomain);
    domainInput.addEventListener('keypress', e=>{ if(e.key==='Enter') lookupDomain(); });

    // init
    initMap();
  </script>
</body>
</html>
